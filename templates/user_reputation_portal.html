<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Reputation & Rate Limits - GAIA System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            color: white;
            margin: 20px auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .score-score {
            font-size: 2.5em;
        }

        .tier-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            margin: 10px auto;
            text-align: center;
            font-size: 1.1em;
        }

        .tier-flagged { background: #ff6b6b; color: white; }
        .tier-standard { background: #4ecdc4; color: white; }
        .tier-trusted { background: #45b7d1; color: white; }
        .tier-premium { background: #f7b731; color: white; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }

        .violation-item {
            padding: 20px;
            border-left: 4px solid #ff6b6b;
            background: #fff5f5;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .violation-date {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        .appeal-btn {
            background: #45b7d1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .appeal-btn:hover {
            background: #2a9d8f;
            transform: translateY(-2px);
        }

        .appeal-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .tier-explanation {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        .tier-explanation h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .tier-explanation p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .tier-explanation ul {
            margin-left: 20px;
            color: #666;
        }

        .tier-explanation li {
            margin-bottom: 8px;
        }

        .faq-item {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .faq-question {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-question::after {
            content: '‚ñº';
            font-size: 0.8em;
            color: #667eea;
            transition: transform 0.3s ease;
        }

        .faq-question.active::after {
            transform: rotate(180deg);
        }

        .faq-answer {
            display: none;
            color: #666;
            line-height: 1.6;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .faq-answer.active {
            display: block;
        }

        .rate-limit-visual {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .limit-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .limit-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .limit-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .breakdown-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 5px;
        }

        .breakdown-label {
            font-size: 0.85em;
            color: #666;
        }

        .breakdown-value {
            font-size: 1.4em;
            font-weight: 600;
            color: #667eea;
            margin-top: 5px;
        }

        .throttle-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            color: #856404;
        }

        .trend-chart {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
            gap: 5px;
        }

        .trend-bar {
            width: 20px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px 3px 0 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .trend-bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }

            .limit-breakdown {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Your Reputation & Rate Limits</h1>
            <p>Understand your status in the GAIA system</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-button" onclick="switchTab('tiers')">Tier System</button>
            <button class="tab-button" onclick="switchTab('violations')">Violations</button>
            <button class="tab-button" onclick="switchTab('faq')">FAQ</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div id="loading-dashboard" class="loading">
                <div class="spinner"></div>
                <p>Loading your reputation data...</p>
            </div>

            <div id="dashboard-content" style="display: none;">
                <div class="card">
                    <h2 style="text-align: center; margin-bottom: 20px;">Your Reputation Score</h2>
                    <div class="score-circle">
                        <span class="score-score" id="reputation-score">--</span>
                    </div>
                    <div style="text-align: center;">
                        <div class="tier-badge" id="tier-badge">Loading...</div>
                        <p style="color: #666; margin-top: 10px;">Multiplier: <strong id="multiplier">-</strong></p>
                    </div>
                </div>

                <div class="card">
                    <h3>Progress to Next Tier</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        <span id="current-score">-</span> / <span id="next-tier-score">-</span> points
                    </p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
                    </div>
                    <p style="color: #666; font-size: 0.9em;">
                        Distance to next tier: <strong id="tier-distance">-</strong> points
                    </p>
                </div>

                <div class="card">
                    <h3>Your Current Rate Limits</h3>
                    <div class="rate-limit-visual">
                        <div class="limit-label">Final Rate Limit (requests per minute)</div>
                        <div class="limit-value" id="final-limit">--</div>
                        <div class="limit-breakdown">
                            <div class="breakdown-item">
                                <div class="breakdown-label">Base Limit</div>
                                <div class="breakdown-value" id="base-limit">1000</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-label">Reputation</div>
                                <div class="breakdown-value" id="rep-multiplier">--</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-label">System Load</div>
                                <div class="breakdown-value" id="throttle-multiplier">--</div>
                            </div>
                        </div>
                    </div>
                    <div id="throttle-warning" style="display: none;"></div>
                </div>

                <div class="card">
                    <h3>Usage This Period</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="usage-bar" style="width: 0%"></div>
                    </div>
                    <p style="text-align: center; color: #666;">
                        <strong id="current-usage">--</strong> / <strong id="final-limit-2">--</strong> requests
                        (<strong id="usage-percent">-</strong>%)
                    </p>
                </div>

                <div class="card">
                    <h3>Quick Stats</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Last Updated</div>
                            <div class="info-value" id="last-updated">--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Recent Violations</div>
                            <div class="info-value" id="violation-count">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Clean Requests (24h)</div>
                            <div class="info-value" id="clean-requests">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Days to Decay</div>
                            <div class="info-value" id="days-to-decay">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tier System Tab -->
        <div id="tiers" class="tab-content">
            <div id="loading-tiers" class="loading">
                <div class="spinner"></div>
                <p>Loading tier information...</p>
            </div>
            <div id="tiers-content" style="display: none;"></div>
        </div>

        <!-- Violations Tab -->
        <div id="violations" class="tab-content">
            <div id="loading-violations" class="loading">
                <div class="spinner"></div>
                <p>Loading your violations...</p>
            </div>
            <div id="violations-content" style="display: none;"></div>
        </div>

        <!-- FAQ Tab -->
        <div id="faq" class="tab-content">
            <div id="loading-faq" class="loading">
                <div class="spinner"></div>
                <p>Loading FAQ...</p>
            </div>
            <div id="faq-content" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/reputation';

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for tab
            if (tabName === 'dashboard' && !document.getElementById('dashboard-content').style.display) {
                loadDashboard();
            } else if (tabName === 'tiers' && !document.getElementById('tiers-content').innerHTML) {
                loadTiers();
            } else if (tabName === 'violations' && !document.getElementById('violations-content').innerHTML) {
                loadViolations();
            } else if (tabName === 'faq' && !document.getElementById('faq-content').innerHTML) {
                loadFAQ();
            }
        }

        function loadDashboard() {
            fetch(`${API_BASE}/me`)
                .then(r => r.json())
                .then(data => {
                    document.getElementById('loading-dashboard').style.display = 'none';
                    document.getElementById('dashboard-content').style.display = 'block';

                    document.getElementById('reputation-score').textContent = Math.round(data.score);
                    document.getElementById('tier-badge').textContent = data.tier.toUpperCase();
                    document.getElementById('tier-badge').className = `tier-badge tier-${data.tier.replace('_', '-')}`;
                    document.getElementById('multiplier').textContent = `${data.multiplier.toFixed(2)}x`;

                    document.getElementById('current-score').textContent = Math.round(data.score);
                    document.getElementById('next-tier-score').textContent = Math.round(data.next_tier_score);
                    document.getElementById('progress-bar').style.width = (data.tier_progress * 100) + '%';
                    document.getElementById('tier-distance').textContent = Math.round(data.next_tier_distance);

                    const rli = data.rate_limit_info;
                    document.getElementById('final-limit').textContent = rli.final_limit.toLocaleString();
                    document.getElementById('final-limit-2').textContent = rli.final_limit.toLocaleString();
                    document.getElementById('rep-multiplier').textContent = `${rli.reputation_multiplier.toFixed(2)}x`;
                    document.getElementById('throttle-multiplier').textContent = `${rli.throttle_multiplier.toFixed(2)}x`;

                    document.getElementById('current-usage').textContent = rli.current_usage.toLocaleString();
                    document.getElementById('usage-bar').style.width = (rli.usage_percent * 100) + '%';
                    document.getElementById('usage-percent').textContent = Math.round(rli.usage_percent * 100);

                    if (rli.throttle_multiplier < 1.0) {
                        const warn = document.getElementById('throttle-warning');
                        warn.innerHTML = `<strong>‚ö†Ô∏è System Load Alert:</strong> Rate limits are reduced due to high system load. They will return to normal when load decreases.`;
                        warn.style.display = 'block';
                    }

                    document.getElementById('last-updated').textContent = new Date(data.last_updated).toLocaleDateString();
                    document.getElementById('violation-count').textContent = data.recent_violations.length;
                    document.getElementById('clean-requests').textContent = data.recent_clean_requests;
                    document.getElementById('days-to-decay').textContent = data.days_to_decay;
                })
                .catch(e => {
                    document.getElementById('loading-dashboard').innerHTML = '<p>Error loading data. Please refresh the page.</p>';
                });
        }

        function loadTiers() {
            fetch(`${API_BASE}/tiers`)
                .then(r => r.json())
                .then(data => {
                    let html = '<div class="card"><h2>GAIA Reputation Tier System</h2>';
                    for (const tier of data.tiers) {
                        html += `
                            <div class="tier-explanation">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h3>${tier.tier.toUpperCase()}</h3>
                                        <p><strong>Score Range:</strong> ${tier.score_range}</p>
                                        <p><strong>Multiplier:</strong> ${tier.multiplier}x</p>
                                    </div>
                                </div>
                                <p>${tier.description}</p>
                                <h4 style="margin-top: 15px; margin-bottom: 10px;">Benefits:</h4>
                                <ul>${tier.benefits.map(b => `<li>${b}</li>`).join('')}</ul>
                                <h4 style="margin-top: 15px; margin-bottom: 10px;">Requirements:</h4>
                                <ul>${tier.requirements.map(r => `<li>${r}</li>`).join('')}</ul>
                            </div>
                        `;
                    }
                    html += '</div>';
                    document.getElementById('tiers-content').innerHTML = html;
                    document.getElementById('loading-tiers').style.display = 'none';
                    document.getElementById('tiers-content').style.display = 'block';
                });
        }

        function loadViolations() {
            fetch(`${API_BASE}/violations`)
                .then(r => r.json())
                .then(data => {
                    let html = '<div class="card"><h2>Your Violations</h2>';
                    if (data.violations.length === 0) {
                        html += '<div class="no-data">No violations! Keep up the good behavior.</div>';
                    } else {
                        for (const v of data.violations) {
                            const appealable = v.can_appeal ? 'active' : 'disabled';
                            html += `
                                <div class="violation-item">
                                    <div>
                                        <strong>${v.reason_code}</strong>
                                        <div class="violation-date">${new Date(v.timestamp).toLocaleDateString()}</div>
                                        <span class="tier-badge tier-${v.severity_label}" style="font-size: 0.8em; padding: 5px 10px;">
                                            ${v.severity_label.toUpperCase()}
                                        </span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: bold; color: #ff6b6b; margin-bottom: 10px;">
                                            -${v.reputation_lost.toFixed(1)} pts
                                        </div>
                                        <button class="appeal-btn ${appealable}" ${v.can_appeal ? '' : 'disabled'}>
                                            ${v.can_appeal ? 'Appeal' : 'Cannot appeal'}
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                    }
                    html += '</div>';
                    document.getElementById('violations-content').innerHTML = html;
                    document.getElementById('loading-violations').style.display = 'none';
                    document.getElementById('violations-content').style.display = 'block';
                });
        }

        function loadFAQ() {
            fetch(`${API_BASE}/faq`)
                .then(r => r.json())
                .then(data => {
                    let html = '<div class="card"><h2>Frequently Asked Questions</h2>';
                    for (const item of data.faq) {
                        html += `
                            <div class="faq-item">
                                <div class="faq-question" onclick="toggleFAQ(this)">
                                    ${item.question}
                                </div>
                                <div class="faq-answer">${item.answer}</div>
                            </div>
                        `;
                    }
                    html += '</div>';
                    document.getElementById('faq-content').innerHTML = html;
                    document.getElementById('loading-faq').style.display = 'none';
                    document.getElementById('faq-content').style.display = 'block';
                });
        }

        function toggleFAQ(element) {
            element.classList.toggle('active');
            element.nextElementSibling.classList.toggle('active');
        }

        // Load dashboard on page load
        window.addEventListener('load', loadDashboard);
    </script>
</body>
</html>
